<!--
  è®­ç»ƒé¡µé¢ - LittleFencer å°ç¨‹åº
-->
<view class="training-container">
  <!-- ç›¸æœºåŒºåŸŸ -->
  <view class="camera-wrapper">
    <camera 
      class="camera"
      device-position="{{cameraPosition}}"
      flash="off"
      frame-size="medium"
      bindinitdone="onCameraReady"
      binderror="onCameraError"
    ></camera>
    
    <!-- éª¨éª¼è¦†ç›–å±‚ -->
    <canvas 
      wx:if="{{skeletonVisible && skeletonPoints.length > 0}}"
      class="skeleton-canvas"
      type="2d"
      id="skeleton-canvas"
    ></canvas>
    
    <!-- ç›¸æœºé”™è¯¯æç¤º -->
    <view class="camera-error" wx:if="{{cameraError}}">
      <text class="error-icon">ğŸ“·</text>
      <text class="error-text">{{cameraError}}</text>
      <button class="btn btn-primary" bindtap="initCamera">é‡è¯•</button>
    </view>
  </view>

  <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
  <view class="status-overlay">
    <view class="status-badge {{currentState}}">
      <text class="status-icon">{{currentState === 'engarde' ? 'âš”ï¸' : currentState === 'lunge' ? 'ğŸ¯' : 'ğŸ”„'}}</text>
      <text class="status-text">{{stateText}}</text>
    </view>
  </view>

  <!-- åé¦ˆæç¤º -->
  <view class="feedback-toast {{feedbackType}}" wx:if="{{feedbackText}}">
    <text>{{feedbackText}}</text>
  </view>

  <!-- Combo è®¡æ•°å™¨ -->
  <view class="combo-container" wx:if="{{comboCount > 0}}">
    <text class="combo-count">{{comboCount}}</text>
    <text class="combo-label">COMBO</text>
  </view>

  <!-- å½•åˆ¶æŒ‡ç¤ºå™¨ -->
  <view class="recording-indicator" wx:if="{{isRecording}}">
    <view class="recording-dot"></view>
    <text class="recording-text">{{recordingDuration}}s</text>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯æ  -->
  <view class="stats-bar">
    <view class="stat-item">
      <text class="stat-value">{{actionCount}}</text>
      <text class="stat-label">åŠ¨ä½œ</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{perfectCount}}</text>
      <text class="stat-label">å®Œç¾</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{maxCombo}}</text>
      <text class="stat-label">æœ€é«˜è¿å‡»</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{sessionDuration}}s</text>
      <text class="stat-label">æ—¶é•¿</text>
    </view>
  </view>

  <!-- æ§åˆ¶æ  -->
  <view class="controls-bar">
    <!-- åˆ‡æ¢æ‘„åƒå¤´ -->
    <button class="control-btn" bindtap="onFlipCamera">
      <text class="btn-icon">ğŸ”„</text>
      <text class="btn-label">ç¿»è½¬</text>
    </button>
    
    <!-- å½•åˆ¶æŒ‰é’® -->
    <button class="control-btn {{isRecording ? 'recording' : ''}}" bindtap="onToggleRecording">
      <text class="btn-icon">{{isRecording ? 'â¹ï¸' : 'âºï¸'}}</text>
      <text class="btn-label">{{isRecording ? 'åœæ­¢' : 'å½•åˆ¶'}}</text>
    </button>
    
    <!-- å¼€å§‹/åœæ­¢è®­ç»ƒ -->
    <button class="control-btn primary {{isTraining ? 'active' : ''}}" bindtap="onToggleTraining">
      <text class="btn-icon">{{isTraining ? 'â¹ï¸' : 'â–¶ï¸'}}</text>
      <text class="btn-label">{{isTraining ? 'åœæ­¢' : 'å¼€å§‹'}}</text>
    </button>
    
    <!-- éª¨éª¼æ˜¾ç¤º -->
    <button class="control-btn" bindtap="onToggleSkeleton">
      <text class="btn-icon">ğŸ¦´</text>
      <text class="btn-label">{{skeletonVisible ? 'éšè—' : 'æ˜¾ç¤º'}}</text>
    </button>
  </view>
</view>
