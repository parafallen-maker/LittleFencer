# LittleFencer 微信小程序 - 开发任务清单

> **项目代号**: LittleFencer-MiniProgram  
> **预估周期**: 6 周  
> **创建日期**: 2026-02-01

---

## 📋 Phase 1: 项目基础 & 训练核心 (Week 1-2)

### 1.1 项目初始化
- [ ] 注册微信小程序账号，获取 AppID
- [ ] 创建小程序项目（原生 / Taro / uni-app 选型）
- [ ] 配置云开发环境
- [ ] 设置 Git 仓库和开发分支策略
- [ ] 配置 CI/CD 自动部署

### 1.2 摄像头模块
- [ ] 集成 `<camera>` 组件
- [ ] 实现前后摄像头切换
- [ ] 处理摄像头权限请求
- [ ] 适配不同屏幕尺寸（横屏/竖屏）

### 1.3 Vision Kit 姿态检测
- [ ] 集成 Vision Kit 人体检测能力
- [ ] 实现 17 关键点提取
- [ ] 开发关键点到骨骼线的转换
- [ ] Canvas 实时渲染骨骼覆盖层

### 1.4 简化版训练逻辑
- [ ] 移植 FencingStateEngine 状态机（简化版）
  - [ ] En Garde 检测
  - [ ] Lunge 检测
  - [ ] Recovery 检测
- [ ] 实现动作计数器
- [ ] 实现 Combo 连击逻辑
- [ ] 实现正确/错误判定（二元反馈）

### 1.5 训练界面 UI
- [ ] 训练主界面布局
- [ ] 状态指示器（预备/检测中/完成）
- [ ] 动作计数显示
- [ ] Combo 火焰动画
- [ ] 训练计时器

### 1.6 视频录制模块
- [ ] 集成 `CameraContext.startRecord()` API
- [ ] 实现手动录制触发（录制按钮）
- [ ] 录制中状态指示（红点闪烁）
- [ ] 录制时长限制（最长 60 秒）
- [ ] 录制结束自动保存到临时路径
- [ ] 录制异常处理（存储空间不足、权限问题）

### 1.7 视频预览与播放
- [ ] 集成 `<video>` 组件
- [ ] 录制完成后即时预览
- [ ] 播放控制（播放/暂停/进度条）
- [ ] 全屏播放支持
- [ ] 视频封面帧提取

### 1.8 视频存储管理
- [ ] 视频保存到相册（`wx.saveVideoToPhotosAlbum`）
- [ ] 视频上传到云存储
- [ ] 本地视频缓存管理
- [ ] 视频元数据存储（时长、大小、训练数据关联）
- [ ] 临时文件清理策略

### 1.9 视频列表/画廊
- [ ] 我的视频列表页面
- [ ] 视频缩略图展示
- [ ] 视频筛选（全部/精彩/最近）
- [ ] 视频删除功能
- [ ] 视频详情页（训练数据展示）

---

## 📋 Phase 2: 社交分享系统 (Week 3-4)

### 2.1 用户系统
- [ ] 微信登录集成（`wx.login`）
- [ ] 用户信息获取（头像、昵称）
- [ ] 用户数据模型设计
- [ ] 云数据库用户表创建

### 2.2 训练数据存储
- [ ] 训练记录数据模型
- [ ] 云数据库训练表创建
- [ ] 训练完成后自动上传记录
- [ ] 历史训练记录查询

### 2.3 成就卡片生成
- [ ] 卡片模板设计（多套风格）
- [ ] Canvas 动态绘制卡片
  - [ ] 渲染用户头像
  - [ ] 渲染训练数据
  - [ ] 渲染精彩帧/GIF
  - [ ] 渲染小程序码
- [ ] 卡片导出为图片
- [ ] 卡片保存到相册

### 2.4 微信分享功能
- [ ] 分享给好友（`wx.shareAppMessage`）
- [ ] 分享到朋友圈（`wx.onShareTimeline`）
- [ ] 自定义分享卡片样式
- [ ] 分享回调追踪

### 2.5 视频分享功能
- [ ] 视频转发给好友（`wx.shareVideoMessage`）
- [ ] 视频发布到视频号（如支持）
- [ ] 视频生成分享链接
- [ ] 精彩片段裁剪（选择起止时间）
- [ ] 视频添加水印/Logo
- [ ] 视频压缩优化（分享前）

### 2.6 挑战系统 - 发起端
- [ ] 挑战数据模型设计
- [ ] 创建挑战接口
- [ ] 生成挑战专属链接/二维码
- [ ] 挑战卡片生成
- [ ] 挑战分享功能

### 2.6 挑战系统 - 接收端
- [ ] 挑战链接解析
- [ ] 挑战详情展示
- [ ] 接受挑战训练流程
- [ ] 挑战结果比对
- [ ] PK 结果卡片生成

---

## 📋 Phase 3: 排行榜 & 运营功能 (Week 5-6)

### 3.1 排行榜系统
- [ ] 排行榜数据模型
- [ ] 周榜计算逻辑（云函数定时任务）
- [ ] 月榜计算逻辑
- [ ] 好友排行榜（基于关系链）
- [ ] 全局排行榜

### 3.2 排行榜 UI
- [ ] 排行榜列表页面
- [ ] 个人排名卡片
- [ ] 榜单切换（周/月/好友/全局）
- [ ] 排名变化动画

### 3.3 引导转化
- [ ] App 下载引导弹窗
- [ ] 功能对比说明页
- [ ] 下载链接跳转（App Store / 应用宝）
- [ ] 转化事件埋点

### 3.4 数据埋点 & 分析
- [ ] 核心事件埋点
  - [ ] 页面浏览
  - [ ] 训练开始/结束
  - [ ] 分享行为
  - [ ] 挑战行为
  - [ ] App 下载点击
- [ ] 数据看板搭建

### 3.5 运营配置
- [ ] 配置后台（云函数管理）
- [ ] 公告/Banner 配置
- [ ] 活动配置能力
- [ ] 远程配置（Feature Flags）

---

## 📋 Phase 4: 云端分析增强 (P1 可选)

### 4.1 云端视频分析
- [ ] 搭建视频分析云函数
- [ ] 集成 MediaPipe Python
- [ ] 视频上传队列
- [ ] 分析结果存储

### 4.2 训练报告
- [ ] 报告数据模型
- [ ] 报告生成逻辑
- [ ] 报告展示页面
- [ ] 报告分享功能

### 4.3 教练模块
- [ ] 教练身份认证
- [ ] 学员列表管理
- [ ] 学员数据查看
- [ ] 远程点评功能

---

## 📋 非功能性任务

### 性能优化
- [ ] 首屏加载优化（分包加载）
- [ ] Canvas 渲染性能优化
- [ ] 图片资源压缩
- [ ] 代码包体积优化

### 测试
- [ ] 单元测试覆盖
- [ ] E2E 测试脚本
- [ ] 真机测试（iOS/Android）
- [ ] 性能测试（低端机型）

### 上线准备
- [ ] 小程序资质材料准备
- [ ] 隐私政策文档
- [ ] 用户协议文档
- [ ] 类目选择确认
- [ ] 提审 & 发布

---

## 📊 进度追踪

| Phase | 状态 | 开始日期 | 完成日期 | 负责人 |
|-------|------|---------|---------|--------|
| Phase 1 | ⬜ 未开始 | - | - | - |
| Phase 2 | ⬜ 未开始 | - | - | - |
| Phase 3 | ⬜ 未开始 | - | - | - |
| Phase 4 | ⬜ 待定 | - | - | - |

---

## 📝 备注

### 技术选型决策点
1. **框架选择**: 原生 vs Taro vs uni-app
   - 原生：性能最优，但开发效率低
   - Taro：可复用 React 经验，跨端能力
   - uni-app：Vue 生态，跨端能力
   - **建议**: Taro（考虑未来可能扩展到其他小程序平台）

2. **后端方案**: 云开发 vs 自建服务器
   - 云开发：快速启动，成本低，但灵活性有限
   - 自建：灵活，但运维成本高
   - **建议**: MVP 阶段用云开发，规模大后迁移

### 风险项
- [ ] Vision Kit 在低端机型的性能待验证
- [ ] 小程序审核可能需要体育类目资质
- [ ] 分享卡片设计需要符合微信规范

---

*最后更新: 2026-02-01*
